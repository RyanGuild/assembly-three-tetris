(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{33:function(e,t,a){e.exports=a(50)},46:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),o=a.n(c),i=a(25),l=a(11),u=a(7);var s=a(27),m={board:null,activeBlock:null,update:-1};var f,d=Object(l.c)({inputKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INPUT_KEY":return t.payload;default:return e}},gameState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"@@init":return Object(s.a)({},m);case"UPDATE_GAME_STATE":return t.payload;default:return e}}});!function(e){e[e.Left=37]="Left",e[e.Up=38]="Up",e[e.Right=39]="Right",e[e.Down=40]="Down",e[e.Space=32]="Space",e[e.W=87]="W",e[e.A=65]="A",e[e.S=83]="S",e[e.D=68]="D",e[e.Shift=16]="Shift",e[e.Tilde=192]="Tilde"}(f||(f={}));var p=a(6),h=a.n(p),E=a(8),y=a(28),g=0,b=Object(y.instantiateStreaming)(fetch("/as-api.wasm"),{index:{consoleLog:function(e){console.log(e)}}}).then((function(e){return Object.assign(e,{GetGameState:function(){var t=e.BOARD_STATE,a=e.BLOCK_STATE,n=e.__getInt32ArrayView,r=n(t),c=n(a),o={activeBlock:{x:c[0],y:c[1],width:c[2],height:c[3],shape:c.slice(4)},board:r,update:g++};return console.log(o),o}})})),v=document.getElementById("canvasRoot")||function(){var e=document.createElement("div");return e.id="canvasRoot",document.body.appendChild(e),e}(),w=Object(n.memo)(Object(n.forwardRef)((function(e,t){var a=e.width,n=e.height,o=e.id;return Object(c.createPortal)(r.a.createElement("div",{id:o},r.a.createElement("canvas",{ref:t,width:a,height:n})),v)}))),S=(a(46),a(18)),_=a(3),x=new _.Vector3(4.5,12.5,0);function T(){return r.a.createElement(n.Fragment,null,r.a.createElement("mesh",{position:x.clone().add(new _.Vector3(15,0,1))},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[20,24,1]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:"grey"})),r.a.createElement("mesh",{position:x.clone().add(new _.Vector3(-15,0,1))},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[20,24,1]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:"grey"})),r.a.createElement("mesh",{position:x.clone().add(new _.Vector3(0,14,1))},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[50,4,1]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:"grey"})),r.a.createElement("mesh",{position:x.clone().add(new _.Vector3(0,-14,1))},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[50,4,1]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:"grey"})),r.a.createElement("mesh",{position:x},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[10,24,1]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:"grey"})))}var k=Object(n.memo)((function(){var e=Object(S.b)().setDefaultCamera;return Object(n.useEffect)((function(){var t=new _.PerspectiveCamera(75,1,.1,1e3);t.position.setZ(18),t.position.setY(x.y-3),t.position.setX(x.x),t.rotateX(.1),e(t)}),[e]),r.a.createElement(r.a.Fragment,null)}),(function(){return!0}));function O(e,t){var a=e.slice(t,t+1);if(0===a[0])return null;var n=new Uint8Array(a.buffer),r=["#"];return r.push(n[0].toString(16)),r.push(n[1].toString(16)),r.push(n[2].toString(16)),r.join("")}function A(){var e=Object(u.d)((function(e){return e.gameState.board}));return e?r.a.createElement(n.Fragment,null,Array.from(e).map((function(t,a){var n=Math.floor(a/24),c=a%24,o=O(e,a);return o?(console.log({rowIndex:n,colIndex:c,color:o}),r.a.createElement("mesh",{key:"".concat(n,",").concat(c),position:new _.Vector3(n,c+1,1)},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.9,.9,.9]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:o}))):null}))):null}function G(){var e=Object(u.d)((function(e){return e.gameState.activeBlock}));if(!e)return null;var t=e.shape,a=e.width,c=e.height,o=e.x,i=e.y;return r.a.createElement(n.Fragment,null,Array.from(t).map((function(e,n){var l=Math.floor(n/c);if(l>c)return null;var u=n%c;if(u>a)return null;var s=O(t,n);return s?r.a.createElement("mesh",{key:"".concat(l,",").concat(u),position:new _.Vector3(o+l,i+u,1)},r.a.createElement("boxBufferGeometry",{attach:"geometry",args:[.9,.9,.9]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:s})):null})))}var j=function(){var e=Object(u.c)(),t=Object(u.d)((function(e){return e.inputKey}));return Object(n.useEffect)((function(){switch(t){case f.Left:e(function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:if(!e.sent.block_left()){e.next=9;break}return e.t0=t,e.next=6,b;case 6:e.t1=e.sent.GetGameState(),e.t2={type:"UPDATE_GAME_STATE",payload:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());break;case f.Right:e(function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:if(!e.sent.block_right()){e.next=9;break}return e.t0=t,e.next=6,b;case 6:e.t1=e.sent.GetGameState(),e.t2={type:"UPDATE_GAME_STATE",payload:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());break;case f.Down:e((console.debug("action: block drop"),function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:if(!e.sent.block_drop()){e.next=9;break}return e.t0=t,e.next=6,b;case 6:e.t1=e.sent.GetGameState(),e.t2={type:"UPDATE_GAME_STATE",payload:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));break;case f.Up:e(function(){var e=Object(E.a)(h.a.mark((function e(t,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:if(!e.sent.block_rotate_cw()){e.next=9;break}return e.t0=t,e.next=6,b;case 6:e.t1=e.sent.GetGameState(),e.t2={type:"UPDATE_GAME_STATE",payload:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}}),[t,e]),r.a.createElement(u.b.Consumer,null,(function(e){var t=e.store;return r.a.createElement("div",{id:"App",onClick:function(){}},r.a.createElement(S.a,null,r.a.createElement(u.a,{store:t},r.a.createElement("ambientLight",null),r.a.createElement("pointLight",{position:[10,10,10]}),r.a.createElement(G,null),r.a.createElement(A,null),r.a.createElement(T,null),r.a.createElement(k,null))))}))},M=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.d,D=Object(l.e)(d,M(Object(l.a)(i.a)));window.addEventListener("keydown",(function(e){var t;D.dispatch((t=e.keyCode)in f?{type:"SET_INPUT_KEY",payload:t}:null)})),window.addEventListener("keyup",(function(e){var t;D.dispatch((t=e.keyCode,function(e,a){a().inputKey===t&&e({type:"SET_INPUT_KEY",payload:null})}))})),D.dispatch((console.debug("action: new game"),function(){var e=Object(E.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:return e.sent.new_game(),e.t0=t,e.next=6,b;case 6:e.t1=e.sent.GetGameState(),e.t2={type:"UPDATE_GAME_STATE",payload:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),o.a.render(r.a.createElement(u.a,{store:D},r.a.createElement(j,null),r.a.createElement(w,{id:"gridRoot",width:100,height:100})),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.2493dd9d.chunk.js.map